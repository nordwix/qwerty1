import java.util.ArrayList;
import java.util.List;

public class Main {

    public static void main(String[] args) {
        
        System.out.println("=== 1. Створення об'єктів через Фабрику (повертає абстрактні типи) ===");
        
        Person r1 = LibraryFactory.createReader("R001", "Іван", "Петренко", "050-123-45-67");
        Person l1 = LibraryFactory.createLibrarian("L001", "Марія", "Василівна", "09:00-17:00");
        
        Publication p1 = LibraryFactory.createFictionBook("978-0743", "It", "Stephen King", 1986, "Horror");
        Publication p2 = LibraryFactory.createNonFictionBook("978-0321", "Clean Code", "Robert Martin", 2008, "Software");
        Publication p3 = LibraryFactory.createMagazine("National Geographic", 2024, 5);

        System.out.println("\n=== 2. Демонстрація єдиної функції (Поліморфізм) ===");
        
        System.out.println("--- Обробка Персон ---");
        processPerson(r1);
        processPerson(l1);
        
        System.out.println("\n--- Обробка Публікацій ---");
        processPublication(p1);
        processPublication(p2);
        processPublication(p3);

        System.out.println("\n=== 3. Дослідження поведінки (Абстрактне vs Пряме посилання) ===");
        
        System.out.println("\n--- Виклик через АБСТРАКТНЕ посилання (Publication p) ---");
        p1.issue();
        
        System.out.println("\n--- Виклик через ПРЯМЕ посилання (FictionBook fb) ---");
        FictionBook fb1 = (FictionBook) p1;
        fb1.issue();

        System.out.println("\n=== 4. Фінальний звіт зі Сховища ===");
        LibraryStorage.showAllAssets();
    }
    
    public static void processPerson(Person person) {
        System.out.println("Обробка особи... Роль: " + person.getRole());
        person.printDetails();
        person.performMainDuty();
    }
    
    public static void processPublication(Publication pub) {
        System.out.println("Обробка публікації... Тип: " + pub.getFullDescription());
        if(pub.isAvailable()) {
            pub.issue();
        } else {
            pub.returnItem();
        }
    }
}

abstract class Person {

    private static int personCounter = 0;

    public static class NameInfo {
        private String firstName;
        private String lastName;

        public NameInfo(String firstName, String lastName) {
            this.firstName = firstName;
            this.lastName = lastName;
        }

        @Override
        public String toString() {
            return firstName + " " + lastName;
        }
    }

    protected String id;
    protected NameInfo nameInfo;
    String internalNotes; 

    public Person(String id, NameInfo nameInfo) {
        this.id = id;
        this.nameInfo = nameInfo;
        this.internalNotes = "N/A";
        personCounter++;
    }

    public String getFullName() {
        return nameInfo.toString();
    }
    
    public static int getPersonCount() {
        return personCounter;
    }
    
    public abstract void printDetails();
    public abstract String getRole();
    public abstract void performMainDuty();
}

abstract class Publication {

    private static int publicationCounter = 0;
    public static final String DEFAULT_STATUS = "в наявності";

    protected String title;
    protected int publicationYear;
    protected String status;

    public Publication(String title, int publicationYear) {
        this.title = title;
        this.publicationYear = publicationYear;
        this.status = DEFAULT_STATUS;
        publicationCounter++;
    }
    
    public boolean isAvailable() {
        return this.status.equals(DEFAULT_STATUS);
    }

    public String getTitle() {
        return title;
    }
    
    public static int getPublicationCount() {
        return publicationCounter;
    }
    
    public abstract void issue();
    public abstract void returnItem();
    public abstract String getFullDescription();

    @Override
    public String toString() {
        return "Publication{" +
                "title='" + title + '\'' +
                ", year=" + publicationYear +
                ", status='" + status + '\'' +
                '}';
    }
}

class Reader extends Person {
    private String phoneNumber;
    private List<Publication> borrowedItems;

    public Reader(String id, String firstName, String lastName, String phoneNumber) {
        super(id, new Person.NameInfo(firstName, lastName));
        this.phoneNumber = phoneNumber;
        this.borrowedItems = new ArrayList<>();
    }
    
    @Override
    public void printDetails() {
        System.out.println("  ID: " + id + ", ПІБ: " + nameInfo.toString() + ", Телефон: " + phoneNumber);
    }
    
    @Override
    public String getRole() {
        return "Читач";
    }
    
    @Override
    public void performMainDuty() {
        System.out.println("  Читач " + getFullName() + " шукає книги.");
    }

    public void borrowItem(Publication item) {
        System.out.println(this.getFullName() + " бере " + item.getTitle());
        this.borrowedItems.add(item);
    }
}

class Librarian extends Person {
    private String shift;

    public Librarian(String id, String firstName, String lastName, String shift) {
        super(id, new Person.NameInfo(firstName, lastName));
        this.shift = shift;
    }
    
    @Override
    public void printDetails() {
        System.out.println("  ID: " + id + ", ПІБ: " + nameInfo.toString() + ", Зміна: " + shift);
    }
    
    @Override
    public String getRole() {
        return "Бібліотекар";
    }
    
    @Override
    public void performMainDuty() {
        System.out.println("  Бібліотекар " + getFullName() + " керує фондом.");
    }
}

abstract class Book extends Publication {
    protected String isbn;
    protected String author;

    public Book(String isbn, String title, String author, int publicationYear) {
        super(title, publicationYear);
        this.isbn = isbn;
        this.author = author;
    }

    @Override
    public void issue() {
        System.out.println("  Видача КНИГИ: '" + this.title + "' (Автор: " + author + ")");
        this.status = "видана";
    }
    
    @Override
    public void returnItem() {
        System.out.println("  Повернення КНИГИ: '" + this.title + "'");
        this.status = "в наявності";
    }
    
    @Override
    public String getFullDescription() {
        return "Книга (Автор: " + author + ", Категорія: " + getGenreOrCategory() + ")";
    }
    
    public abstract String getGenreOrCategory();
}

class Magazine extends Publication {
    private int issueNumber;

    public Magazine(String title, int publicationYear, int issueNumber) {
        super(title, publicationYear);
        this.issueNumber = issueNumber;
    }

    @Override
    public void issue() {
        System.out.println("  Видача ЖУРНАЛУ: '" + this.title + "' (№ " + issueNumber + ")");
        this.status = "видана";
    }
    
    @Override
    public void returnItem() {
        System.out.println("  Повернення ЖУРНАЛУ: '" + this.title + "'");
        this.status = "в наявності";
    }
    
    @Override
    public String getFullDescription() {
        return "Журнал (Випуск: " + issueNumber + ")";
    }
}

class FictionBook extends Book {
    private String genre;

    public FictionBook(String isbn, String title, String author, int publicationYear, String genre) {
        super(isbn, title, author, publicationYear);
        this.genre = genre;
    }
    
    @Override
    public String getGenreOrCategory() {
        return genre;
    }
    
    @Override
    public void issue() {
        System.out.println("  Видача ХУДОЖНЬОЇ КНИГИ: '" + this.title + "' (Жанр: " + genre + ")");
        this.status = "видана";
    }
}

class NonFictionBook extends Book {
    private String category;

    public NonFictionBook(String isbn, String title, String author, int publicationYear, String category) {
        super(isbn, title, author, publicationYear);
        this.category = category;
    }
    
    @Override
    public String getGenreOrCategory() {
        return category;
    }
    
    @Override
    public void issue() {
        System.out.println("  Видача НАУКОВОЇ КНИГИ: '" + this.title + "' (Категорія: " + category + ")");
        this.status = "видана";
    }
}

final class LibraryStorage {

    public static final List<Person> ALL_PEOPLE = new ArrayList<>();
    public static final List<Publication> ALL_PUBLICATIONS = new ArrayList<>();

    private LibraryStorage() {}

    public static void addPerson(Person person) {
        if (person != null) {
            ALL_PEOPLE.add(person);
            System.out.println("STORAGE: Зареєстровано особу (" + person.getRole() + "): " + person.getFullName());
        }
    }

    public static void addPublication(Publication pub) {
        if (pub != null) {
            ALL_PUBLICATIONS.add(pub);
            System.out.println("STORAGE: Зареєстровано публікацію: " + pub.getTitle());
        }
    }

    public static void showAllAssets() {
        System.out.println("\n============== ЗВІТ БІБЛІОТЕКИ ==============");
        System.out.println("--- Загальна кількість осіб: " + Person.getPersonCount() + " ---");
        for (Person p : ALL_PEOPLE) {
            p.printDetails();
        }
        
        System.out.println("\n--- Загальна кількість публікацій: " + Publication.getPublicationCount() + " ---");
        for (Publication p : ALL_PUBLICATIONS) {
            System.out.println("  - " + p.getTitle() + " (" + p.getFullDescription() + "), Статус: " + p.status);
        }
        System.out.println("==============================================");
    }
}

final class LibraryFactory {

    private LibraryFactory() {}

    public static Person createReader(String id, String firstName, String lastName, String phone) {
        Person reader = new Reader(id, firstName, lastName, phone);
        LibraryStorage.addPerson(reader);
        return reader;
    }

    public static Person createLibrarian(String id, String firstName, String lastName, String shift) {
        Person librarian = new Librarian(id, firstName, lastName, shift);
        LibraryStorage.addPerson(librarian);
        return librarian;
    }
    
    public static Publication createFictionBook(String isbn, String title, String author, int year, String genre) {
        Publication book = new FictionBook(isbn, title, author, year, genre);
        LibraryStorage.addPublication(book);
        return book;
    }
    
    public static Publication createNonFictionBook(String isbn, String title, String author, int year, String category) {
        Publication book = new NonFictionBook(isbn, title, author, year, category);
        LibraryStorage.addPublication(book);
        return book;
    }

    public static Publication createMagazine(String title, int year, int issueNumber) {
        Publication mag = new Magazine(title, year, issueNumber);
        LibraryStorage.addPublication(mag);
        return mag;
    }
}
